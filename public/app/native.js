define(['ractive', 'rv!nativeTest/native'],
	function(Ractive, template) {
		var nativeTest = {};

		nativeTest.initialize = function(parentElement) {
			this.data = {
				brightness: 1,
				contrast: 1,
				grayscale: 0,
				hue: 0,
				invert: 0,
				saturate: 1,
				sepia: 0
			};

			this._ractive = new Ractive({
				append: true,
				data: this.data,
				el: parentElement,
				template: template
			});

			this._canvas = this._ractive.find('#nativeCanvas');
			this._context = this._canvas.getContext('2d');

			var img = new Image();
			img.onload = function() {
				this._canvas.width = img.width > 620 ? 620 : img.width;
				this._canvas.height = img.width > 620 ? img.height / img.width * 620 : img.width;
				this._context.drawImage(img, 0, 0, this._canvas.width, this._canvas.height);
			}.bind(this);
			img.src = 'app/testImage.jpg';

			this._resultImage = this._ractive.find('#nativeResult');

			this._ractive.on({
				captureImage: this.captureImage.bind(this),
				defaults: this.setToDefault.bind(this)
			});
		};

		nativeTest.captureImage = function() {
			this._resultImage.setAttribute('src', this._canvas.toDataURL('image/png'));
		};

		nativeTest.setToDefault = function() {
			this._ractive.set('brightness', 1);
			this._ractive.set('contrast', 1);
			this._ractive.set('grayscale', 0);
			this._ractive.set('hue', 0);
			this._ractive.set('invert', 0);
			this._ractive.set('saturate', 1);
			this._ractive.set('sepia', 0);
		};

		return nativeTest;
	}
);
